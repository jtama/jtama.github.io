= Tout publier avec JReleaser
include::../../../../includes/attributes-fr.adoc[]
:description: Arr√™tez de penser au comment et pr√©occupez-vous du quoi !
:page-tags: Tutoriels
:page-image: https://jreleaser.org/images/jreleaser-duke.png
:page-author: jtama
:page-date: 2025-11-18
:page-key: tout-publier-avec-jreleaser
:toc:


[quote, Slogan officiel]
____
https://jreleaser.org/[*JReleaser*,window=_blank]

The quick and effortless way to release your project!

Java, Go, Node, Rust, Zig, Swift, Perl, Python, C/C++, C#, Elixir, Haskell, Ruby, Crystal, and more.
____
ie - _Publier voter projet rapidement et sans effort._

JReleaser est un outil qui effectue les √©tapes les plus courantes li√©es √† la publication de votre application.

Publier un projet ce n'est pas seulement pousser un paquet vers un d√©p√¥t centralis√©. Cela peut aussi signifier signer et g√©n√©rer les artefacts, produire un _SBOM_, assembler et publier un _changelog_, annoncer la publication sur votre _hub_ git favori, et m√™me faire le dire sur Zulip, Bluesky et encore bien d'autres choses.

image:https://jreleaser.org/guide/latest/concepts/_images/jreleaser-workflow.png[Flux de travail JReleaser, link=https://jreleaser.org/guide/latest/concepts/workflow.html,window=_blank]

Dans cet article, nous nous concentrerons sur la publication d'une application Java.

== Attendez, ce n'est pas juste Maven ü´ò !

Chaque gestionnaire de paquets, chaque d√©p√¥t d'artefacts a sa propre sp√©cificit√©.

Comme _Maven Central_ est le but ultime pour les d√©veloppeurs Java, et comme c'est aussi l'un des d√©p√¥ts les plus compliqu√©s, c'est celui que nous examinerons dans cet article de blog. Mais bien s√ªr, une fois que vous aurez fait cela, tout le reste sera du g√¢teau üßÅ !

== Pr√©-requis (outils ‚öíÔ∏è et identifiants üîê)

=== PGP

==== G√©n√©rer votre paire de cl√©s PGP

[source,console]
----
gpg --generate-key
----

.Cela affichera l'invite suivante
[%collapsible]
====
[source, console]
----
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
gpg: /root/.gnupg/trustdb.gpg: trustdb created
gpg: directory '/root/.gnupg/openpgp-revocs.d' created
gpg: revocation certificate stored as '/root/.gnupg/openpgp-revocs.d/4C2428BC373276273A30B9D4FA30C263300AD893.rev'
public and secret key created and signed.

pub   ed25519 2025-11-18 [SC] [expires: 2028-11-17]
      4C2428BC373276273A30B9D4FA30C263300AD893<1>
uid                      Guess who's back ? <back_again@shady.com>
sub   cv25519 2025-11-18 [E] [expires: 2028-11-17]
----
<1> Ceci est votre identifiant de cl√© ; conservez-le quelque part.
====


On vous demandera une phrase de passe pour prot√©ger votre paire de cl√©s. Choisissez judicieusement, et ne le dites √† personne.

.ü§´chhhhhht!
[%collapsible]
====
‚ù§Ô∏è Dave<3<3
====


Si vous oubliez de sauvegarder votre identifiant de cl√©, vous pouvez le retrouver en utilisant la

.commande `list-keys`
[%collapsible]
====
[source,console]
----
# gpg --list-keys
/root/.gnupg/pubring.kbx
------------------------
pub   ed25519 2025-11-18 [SC] [expires: 2028-11-17]
      4C2428BC373276273A30B9D4FA30C263300AD893
uid           [ultimate] Guess who's back ? <back_again@shady.com>
sub   cv25519 2025-11-18 [E] [expires: 2028-11-17]
----
====

==== La distribuer icon:key[]

Il existe plusieurs serveurs de cl√©s publics et parmi ceux-ci, les suivants sont support√©s nativement: `keyserver.ubuntu.com`, `keys.openpgp.org`, `pgp.mit.edu`.

La commande suivante rendra votre cl√© publique disponible :

[source,console]
----
gpg --keyserver keyserver.ubuntu.com -send-key 4C2428BC373276273A30B9D4FA30C263300AD893<1>
----
<1> Remplacez par votre propre identifiant

[[obtaining-your-maven-central-credentials]]
=== Obtenir vos identifiants Maven Central.

Connectez-vous √† https://central.sonatype.com/[maven central], cliquez sur l'√©l√©ment de menu en haut √† droite "View User Tokens", et g√©n√©rez un nouveau jeton.

Vous pouvez sp√©cifier son nom et sa date d'expiration. Personnellement, j'ai choisi de faire une folie pour celui-ci :

image::sonatype_token.png[Le nom du jeton est JReleaser]

=== Installer JReleaser

Il existe de nombreuses fa√ßons https://jreleaser.org/guide/latest/install.html[d'installer JReleaser,window=_blank], mais mon choix pour mon environnement de dev est d'utiliser https://www.jbang.dev/[JBang,window=_blank] :

[source, console]
----
// T√©l√©charge, et installe localement
jbang app install jreleaser@jreleaser

// Ex√©cuter en utilisant
jreleaser <command> [<args>]
----

Si vous pr√©f√©rez l'ex√©cuter sans l'installer, vous pouvez aussi utiliser JBang :

[source, console]
----
// T√©l√©charger, mettre en cache, et ex√©cuter
jbang jreleaser@jreleaser <command> [<args>] <1>
----
<1> Si vous ne l'aviez pas compris, j'aime bien JBang

=== V√©rifier votre descripteur de projet

M√™me si JReleaser le fera pour vous, vous pouvez toujours v√©rifier ind√©pendamment si votre descripteur de projet contient tous les champs obligatoires pour √™tre publi√© en ex√©cutant :

[source, console]
----
jbang pomchecker@kordamp check-maven-central
----

Corriger votre descripteur en cons√©quence et r√©p√©ter l'op√©ration jusqu'√† ce que tout soit propre.

== Configurer votre projet

C'est un processus en 2 √©tapes. Vous devez configurer JReleaser mais aussi votre processus de build pour g√©n√©rer tous les artefacts n√©cessaires √† la publication (ici par exemple la javadoc DOIT √™tre g√©n√©r√©e).

=== La configuration Maven

Ajoutez un profil `release` √† votre `pom.xml` :

.profil release
[%collapsible]
====
[source, xml]
----
<profile>
    <id>release</id>
    <properties>
        <altDeploymentRepository>
            local::file:./target/staging-deploy <1>
        </altDeploymentRepository>
    </properties>
    <build>
        <defaultGoal>deploy</defaultGoal>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-javadoc-plugin</artifactId>
                <executions>
                    <execution>
                        <id>attach-javadocs</id>
                        <goals>
                            <goal>jar</goal>
                        </goals>
                        <configuration>
                            <attach>true</attach>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-source-plugin</artifactId>
                <executions>
                    <execution>
                        <id>attach-sources</id>
                        <goals>
                            <goal>jar</goal>
                        </goals>
                        <configuration>
                            <attach>true</attach>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
</profile>
----
<1> [[local-deployment-repository]]Vous pouvez bien s√ªr changer cette valeur
====

=== La configuration Gradle

Si vous utilisez Gradle, je suis s√ªr que vous savez comment produire la configuration √©quivalente. Moi non.

=== La configuration JReleaser

Vous pouvez initialiser la configuration de votre projet avec la commande suivante :

[source, console]
----
jbang jreleaser@jreleaser init
//ou si vous l'avez installer localement
jreleaser init

----

Cela g√©n√©rera votre fichier de configuration de projet que vous devrez modifier selon vos besoins.

.jreleaser.yaml
[%collapsible]
====
[source,yaml]
----
# Generated with JReleaser 1.21.0 at 2025-11-19T09:09:25.55515446Z
project:
  name: app
  version: 1.0.0-SNAPSHOT
  description: Awesome App
  longDescription: Awesome App
  authors:
    - Duke
  license: Apache-2.0
  links:
    homepage: https://acme.com/app
  languages:
    java:
      groupId: com.acme
      version: 8
  inceptionYear: 2025

release:
  github:
    owner: duke

distributions:
  app:
    artifacts:
      - path: path/to/{{distributionName}}-{{projectVersion}}.zip
----
====


Les sections `distributions` et `github` peuvent √™tre supprim√©es si vous voulez seulement un d√©ploiement `maven`. Vous devrez par contre sp√©cifier la configuration de d√©ploiement maven en ajoutant ce qui suit √† votre fichier de configuration :

[source, yaml]
----
signing: <1>
  active: ALWAYS
  armored: true

deploy: <2>
  maven:
    mavenCentral:
      release-deploy:
        active: RELEASE
        url: https://central.sonatype.com/api/v1/publisher
        stagingRepositories:
          - target/staging-deploy <3>
    nexus2:
      snapshot-deploy:
        active: SNAPSHOT
        snapshotUrl: https://central.sonatype.com/repository/maven-snapshots/
        applyMavenCentralRules: true
        snapshotSupported: true
        closeRepository: true
        releaseRepository: true
        stagingRepositories:
          - target/staging-deploy <3>
----
<1> Laisse JReleaser faire la signature des artefacts pour vous
<2> Quel d√©p√¥t maven utiliser pour les d√©ploiements *release* et *snapshot*
<3> O√π trouver les artefacts localement. Doit correspondre √† <<local-deployment-repository, la valeur utilis√©e dans votre configuration de projet>>.

Vous devrez sp√©cifier quelques variables secr√®tes, mais pour des raisons de s√©curit√© √©videntes, PAS dans un fichier source versionn√©...

== Sp√©cifier les variables

La plupart des identifiants n√©cessaires √† JReleaser seront communs √† tous vos projets. Donc les d√©finir globalement pour JReleaser est une bonne chose. Je les d√©finis dans le dossier par d√©faut de JReleaser. Par d√©faut `$HOME/.jreleaser/config.properties` (les formats accept√©s sont `PROPERTIES`, `YAML`, `TOML` et `JSON`)

https://jreleaser.org/guide/latest/reference/environment.html#_env_files[Pour en savoir plus √† ce sujet].

J'ai choisi `TOML` et voici √† quoi ressemble mon fichier :

[source, toml]
.~/.jreleaser/config.toml
----
JRELEASER_GPG_PUBLIC_KEY = """-----BEGIN PGP PUBLIC KEY BLOCK-----

<place_your_public_key_here>
-----END PGP PUBLIC KEY BLOCK-----""" <1>
JRELEASER_GPG_SECRET_KEY = """-----BEGIN PGP PRIVATE KEY BLOCK-----

<place_your_secret_key_here>
-----END PGP PRIVATE KEY BLOCK-----"""

JRELEASER_DRAFT = true <2>
JRELEASER_GPG_PASSPHRASE = "‚ù§Ô∏è Dave<3<3"
JRELEASER_MAVENCENTRAL_RELEASE_DEPLOY_USERNAME = "redacted"
JRELEASER_MAVENCENTRAL_RELEASE_DEPLOY_TOKEN = "redacted"
JRELEASER_NEXUS2_SNAPSHOT_DEPLOY_USERNAME = "redacted"
JRELEASER_NEXUS2_SNAPSHOT_DEPLOY_TOKEN = "redacted" <3>
----
<1> TOML supporte les cha√Ænes multilignes utilisant des triples _quotes_ : `"""`
<2> Je fais seulement des "draft release" depuis l'environnement de dev
<3> Valeurs obtenues dans le chapitre <<obtaining-your-maven-central-credentials>>. Ce sont les m√™mes pour *maven central* et *nexus2_snapshot*

Une derni√®re chose, je pr√©f√®re faire uniquement des _dry run_ localement, mais cela ne peut pas √™tre sp√©cifi√© via un fichier pour le moment, donc j'exporte la valeur juste avant de lancer les commandes:

[source, console]
----
export JRELEASER_DRY_RUN=true && jreleaser full-release
----

Une fois que vous √™tes satisfait, vous pouvez √©ventuellement d√©sactiver la propri√©t√© dry run et relancer, mais je pr√©f√®re faire la vraie publication depuis ma _**CI**_, qui est Github image:github-icon.svg[Ic√¥ne Github,20,16] pour le moment.

== Ex√©cuter tout √ßa depuis Github image:github-actions.svg[Github actions,height=40]

Voici le workflow github minimal pour publier une application maven.

[source, yaml]
----
name: Release
on:
  workflow_dispatch: <1>
    inputs:
      version: <2>
        description: "Release version"
        required: true

jobs:
  build:
    needs: [ precheck ]
    name: 'Build artefacts'
    runs-on: ubuntu-latest
    steps:
      - name: 'Check out repository'
        uses: actions/checkout@v4
        with:
          ref: ${{ needs.precheck.outputs.HEAD }}
      - name: 'Set up Java'
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 21
          cache: 'maven'
      - name: 'Build artefacts'
        run: mvn -B -P release clean deploy
      - name: Deploy to Central
        uses: jreleaser/release-action@v2 <3>
        with:
          version: latest
          arguments: 'full-release' <4>
        env:
          JRELEASER_GPG_PUBLIC_KEY: ${{ secrets.GPG_PUBLIC_KEY }}
          JRELEASER_GPG_SECRET_KEY: ${{ secrets.GPG_PRIVATE_KEY }}
          JRELEASER_GPG_PASSPHRASE: ${{ secrets.GPG_PASSPHRASE }}
          JRELEASER_MAVENCENTRAL_USERNAME: ${{ secrets.SONATYPE_USERNAME }}
          JRELEASER_MAVENCENTRAL_PASSWORD: ${{ secrets.SONATYPE_PASSWORD }}
          JRELEASER_NEXUS2_USERNAME: ${{ secrets.SONATYPE_USERNAME }}
          JRELEASER_NEXUS2_TOKEN: ${{ secrets.SONATYPE_PASSWORD }} <5>
          JRELEASER_PROJECT_VERSION: ${{ github.event.inputs.version }} <2>
         #JRELEASER_DRAFT: true <6>
----
<1> Workflow d√©clench√© manuellement
<2> La version √† publier. Elle pourrait aussi √™tre r√©cup√©r√©e depuis votre projet maven.
<3> Utilise la github action JReleaser (Il existe aussi des int√©grations avec Gitlab, Gitea et bien d'autres)
<4> Ex√©cute le workflow *full-release*
<5> Toutes les valeurs √† assigner dans les secrets de votre projet
<6> Si vous voulez ou non faire des "draft releases".


== Conclusion

Nous n'avons fait qu'effleurer la surface de ce qui peut √™tre fait avec JReleaser. Si vous voulez un exemple vraiment complet, https://jreleaser.org/guide/latest/examples/jreleaser.html[voici comment JReleaser se publie lui-m√™me], avec JReleaser bien s√ªr.

Mais au moins, vous savez comment publier vos artefacts sur Maven Central üóª \o/ . Ce soir √ßa va briller en soci√©t√©.
