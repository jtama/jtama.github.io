= Techniques Avancées d'OpenRewrite : Utiliser les messages pour implémenter des logiques complexes
include::../../../../includes/attributes.adoc[]
:description: Comment mettre en place des actions coordonnées sur plusieurs niveaux d'AST...
:page-tags: openrewrite
:page-image: pexels-pixabay-260551.jpg
:page-author: jtama
:page-date: 2025-09-05
:page-draft: true
:qute: true

__Photo par Pixabay.footnote:[https://www.pexels.com/photo/water-drops-on-blue-background-260551/[Pixabay]]
__

Je vous avais déjà parlé d'Openrewrite dans link:../openrewrite-refactoring-as-code[un article précédent]. Si vous ne l'avez pas lu et que vous avez besoin d'un petit rafraichissement, je vous invite à mettre la lecture de ce post en icon:pause[] et à y revenir plus tard. C'est bon ? Allez go.

Tous les cas d'usage dont il a été question dans l'article précédent font intervenir une recette qui n'a besoin que des informations trouvées à un et seul niveau du https://docs.openrewrite.org/concepts-and-explanations/lossless-semantic-trees[LST]. Puisqu'une image vaut mieux qu'un long discours, et que je sens bien que je ne me suis pas très bien fait comprendre, voici un exemple crédible d'AST:
\{empty} +


{#diagram asciidoc=true language="plantuml" alt="Exemple d'AST simplifié" width=800 height=300 diagramOutputFormat="svg"}
@startmindmap
top to bottom direction
*[#f2d5cf] Classe
**[#ca9ee6] Déclaration de méthode
***[#ea999c] Bloc
****[#a6d189] Assignation de variable 1
****[#a6d189] Invocation de méthode 1
****[#a6d189] for
*****[#85c1dc] Assignation de variable 2
*****[#85c1dc] Invocation de méthode 2
*****[#85c1dc] Retour de méthode
@endmindmap
{/}

\{empty} +
Jusqu'à présent les exemples opéraient des modifications sur [.bg-green]#des invocations de méthodes#, ou par exemple un renommage de [.bg-rosewater]#classe#.

Dans le diagramme précédent, chaque nœud correspond à un élément d'AST (les choses sont évidemments simplifiées ici). Comme nous l'avons déjà vu, https://docs.openrewrite.org/[OpenRewrite] utilise le _pattern_ visiteur pour parcourir l'arbre. Plus précisément les recettes implémentent des visiteurs dont les interfaces correspondent au langage manipulé. +
En l'occurence, les manipulations sont effectuées sur du https://dev.java/[Java], et le visiteur utilisé sera donc un `https://github.com/openrewrite/rewrite/blob/main/rewrite-java/src/main/java/org/openrewrite/java/JavaIsoVisitor.java[JavaIsoVisitor]`.

Oui, mais si mon cas d'usage nécessite d'identifier [.bg-green]#une invocation de méthode# pour agir sur [.bg-mauve]#la déclaration de la méthode# qui la contient dans [.bg-rosewater]#une classe#?